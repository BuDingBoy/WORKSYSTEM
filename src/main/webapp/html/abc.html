<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" type="text/css" href="../css/workRecord.css"/>
    <link rel="stylesheet" type="text/css" href="../css/abc.css"/>

    <link href="../css/bootstrap.css" type="text/css" rel="stylesheet">
    <script type="text/javascript" src="../js/jquery-3.3.1.js"></script>
    <script type="text/javascript" src="../js/bootstrap.js"></script>
    <script type="text/javascript" src="../js/abcCommon.js"></script>
</head>
<body >
<header class="commonHeader">
    <div class="login-div">
        <nav class="top-nav-connect"><a href="WriteWorkRecord.html">写博文</a></nav>
        <img src="../images/monkey1.jpg" id="imgPhoto">
        <span class="loginIDStyle" id="loginNickname">一寸灰</span>
    </div>
</header>
<main class="mainClass">
    <aside class="workAside">
        <div class="nav-div">
            <form id="search-form" >
                <div><span>始    发    站</span>
                    <select name="beginAir" class="air-select" >
                        <option value="PEK">北京</option>
                        <option value="SHA">上海</option>
                        <option value="CAN">广州</option>
                        <option value="CTU">成都</option>
                    </select></div>
                <div><span>终   点   站</span>
                    <select  name="endAir"  class="air-select">
                        <option value="PEK">北京</option>
                        <option value="SHA">上海</option>
                        <option value="CAN">广州</option>
                        <option value="CTU">成都</option>
                    </select>
                </div>
                <div> <span>起飞时间</span><input type="date"  name="startTime" class="air-select"></div>
                <div><span>员工职级</span>
                    <select name="level" class="air-select">
                    <option value="1">总经理</option>
                    <option value="2">处级</option>
                    <option value="3">普通员工</option>

                </select>
                </div>
                <div> <input type="button" value="搜索" onclick="search()"></div>

            </form>

        </div>
        <div class="contact-me">
            <div>
                <div><img src="../images/2D.gif" class="QR-img"></div>
            </div>
        </div>
    </aside>
    <div class="workContent">
        <div>
            <form id="workRecordForm">
                <div class="catalog"  >
                    <select name="beginAir" style="width: 150px" >
                        <option value="PEK">北京</option>
                        <option value="SHA">上海</option>
                        <option value="CAN">广州</option>
                    </select>
                    <span>到</span>
                    <select name="endAir" style="width: 150px" >
                        <option value="PEK">北京</option>
                        <option value="SHA">上海</option>
                        <option value="CAN">广州</option>
                    </select>

                    <input type="date" placeholder="起飞时间" name="startTime" >

                    <input type="button" value="搜索" >

                </div>
                <div id="abcFlightDiv">
                    <div class="a-workRecord-div" onmouseout="overShow(this)" onmouseover="openLink(this)">
                       <div>
                           <h4>航空公司</h4>
                           <p>MUDD34航班</p>

                       </div>
                        <div class="travel-div">
                            <div >
                                <h4>07:23</h4>
                                <p>浦东机场</p>
                            </div>
                            <div  class="time-div">
                                <p class="tiem-p">3小时35分</p>
                                <hr class="timeHr">
                            </div>
                            <div>
                                <h4 >10:40</h4>
                                <p>双流机场</p>
                            </div>
                        </div>
                        <div class="sit">
                            <div class="sit-price" style="color: #55ff79" >
                                经济舱： <h4 style="color: gold">666</h4>
                                <p style="color: red">4.5折</p>
                            </div>
                            <div><input type="button" class="yuding-button" onclick="searchFlightPrice()" value="预定">
                            </div>
                        </div>

                    </div>
                </div>
            </form>
        </div>

    </div>

</main>
<footer>
</footer>

</body>
<script type="text/javascript">

    //设置连接的点击样式
    $(() => {
    });


    var FLIGHT;
    function search() {
        let data={};
        data.arr=$('#search-form select[name="endAir"] ').val()
        data.dpt=$('#search-form select[name="beginAir"] ').val()
        data.date=$('#search-form input[name="startTime"] ').val()
        data.ex_track='tehui'
        data.level=$('#search-form select[name="level"] ').val()
        console.log(data)

        let params={};
        params.arr='PVG'
        params.dpt='PEK'
        params.date='2018-12-09'
        params.ex_track='tehui'
        params.level="1";
        console.log(params)
        $.post('/WORKSYSTEM/abc/getdata.dao',data,(results) =>{
            FLIGHT=results;
            getFlight(0,10)
        },'json');
    }

    function getFlight(start,end){
        var str = "";
        console.log(FLIGHT)
        for (let i=start;i<end;i++) {
            var varrieName=FLIGHT[i].carrierName;
           if (varrieName==null ||varrieName==''){
               varrieName='东方航空公司';
           }
            str +=`
             <div class="a-workRecord-div" >
                       <div style="width: 200px">
                           <h4>${varrieName}</h4>
                           <p>${FLIGHT[i].actFlightNum}航班</p>

                       </div>
                        <div class="travel-div">
                            <div >
                                <h4>${FLIGHT[i].dptTime}</h4>
                                <p>${FLIGHT[i].dptAirport}${FLIGHT[i].dptTerminal}</p>
                            </div>
                            <div  class="time-div">
                                <p class="tiem-p">${FLIGHT[i].flightTimes}</p>
                                <hr class="timeHr">
                            </div>
                            <div>
                                <h4 >${FLIGHT[i].arrTime}</h4>
                                <p>${FLIGHT[i].arrAirport}${FLIGHT[i].arrTerminal}</p>
                            </div>
                        </div>
                        <div class="sit">
                            <div class="sit-price" style="color: #55ff79" >
                            经济舱： <h4 style="color: gold">${FLIGHT[i].barePrice}</h4>
                            <p style="color: red">${FLIGHT[i].discount}折</p>
                            </div>
                            <div><input type="button" class="yuding-button" onclick="searchFlightPrice()" value="预定">
                            </div>
                        </div>
                    </div>
            `;
        }
        $('#abcFlightDiv').html(str)
    }

    function searchFlightPrice() {
        let params={};
        params.arr='CAN'
        params.dpt='PEK'
        params.date='2018-12-09'
        params.flightNum='MU3003'
        params.ex_track='tehui'
        params.level="1";
        console.log(params)
        $.post('/WORKSYSTEM/abc/searchFlightPrice.dao',params,(results) =>{
           console.log(results)
        },'json');
    }
function yuding(){

}
    $('#allChecked').change(function () {
        $('#showWorkRecord input[type="checkbox"][name="workRecordCheck"]').prop('checked', $(this).is(':checked') ? true : false);
    });

    function buttonOperation() {
        var operationType = $('#modalWorkRecord input[name="operationType"] ').val();
        // alert(operationType);
        if (operationType == '1') {
            addWorkRecord()
        } else if (operationType == '2') {
            modifyWorkRecord();
        }
    }

    function add() {
        $('#modalWorkRecord input[name="operationType"]').val("1");
        $('#modalWorkRecord textarea[name="content"]').val('');
        $('#modalWorkRecord textarea[name="noCompleted"]').val('');
        $('#modalWorkRecord textarea[name="title"]').val('');
        $('#myModal').modal('show');
    }

    function addWorkRecord() {

        var data = {};
        data.content = $('#modalWorkRecord textarea[name="content"]').val();
        data.noCompleted = $('#modalWorkRecord textarea[name="noCompleted"]').val();
        data.title = $('#modalWorkRecord textarea[name="title"]').val();
        // console.log(data);
        // alert(data.title);
        $.post("../workRecord/insertWorkRecord.dao", data, function (results) {
            searchWorkRecord()

        }, "text");
    }

    function searchWorkRecord() {
        var data = {};
        $.post("../workRecord/findWorkRecordByWhere.dao", data, (results) => {
            var str = "";
            $.each(results, (i, workRecordVO) => {
                var comp = workRecordVO.content;
                if (comp.length > 150) {
                    comp = comp.slice(0, 150) + '...';
                }
                str += `
            <div class="a-workRecord-div" onmouseout="overShow(this)" onmouseover="openLink(this)">
                <input type="hidden" name="recordID" value="${workRecordVO.recordID}">
                <input type="hidden" name="staffID" value="${workRecordVO.staffID}">
                <h4 class="a-workRecord-title-h" ><a onclick="lookWorkRecord(this)">${workRecordVO.title}</a></h4>
                <p class="a-workRecord-context-p">${comp}</p>
                <div class="a-workRecord-dis">
                    <span>${workRecordVO.recordDate}</span>
                    <div>
                        <nav >
                            <a href="WriteWorkRecord.html" onclick="modifyWorkRecord(this)">编辑</a>|
                            <input type="button" value="删除" onclick="del(this)">
                        </nav>
                    </div>
                </div>
            </div>
            `;

            });
            // $("#abcFlightDiv").html(str);
        }, "json");
    }

    function del(butt) {
        let data = {};
        data.recordID = $(butt).parents('.a-workRecord-div').children('input[name="recordID"]').val();
        $.post("../workRecord/deleteWorkRecordByKey.dao", data, (results) => {
            if (results == '1') {
                searchWorkRecord();
            } else {
                alert('删除失败！');
            }
        }, 'text');
    }

    /**
     * 鼠标移动到上面时显示右下角操作连接
     */
    function openLink(x) {
        // console.log( $(x).find("nav").text())
        $(x).find("nav").css("display", "inline");
    }

    function overShow(x) {
        $(x).find("nav").css("display", "none");
    }

    function lookWorkRecord(x) {
        var recordID = $(x).parents('.a-workRecord-div').children('input[name="recordID"]').val();
        $(x).prop('href', 'ReadWorkRecord.html?recordID=' + recordID);
    }

    /**
     * 修改工作记录
     * @param x
     */
    function modifyWorkRecord(x) {
        var recordID = $(x).parents('.a-workRecord-div').children('input[name="recordID"]').val();
        $(x).prop('href', 'WriteWorkRecord.html?recordID=' + recordID);

    }

    function deleteWorkRecord() {
        let $compnent = $('#showWorkRecord input[name="workRecordCheck"]:checked').parent('td').parent('tr');
        var recordID = '';
        for (var i = 0; i < $compnent.length; i++) {
            if (i == 0) {
                recordID = $compnent.eq(i).children('td[name="recordID"]').text();
            } else {
                recordID += ',' + $compnent.eq(i).children('td[name="recordID"]').text();
                console.log(recordID);
            }
        }
        alert(recordID);
        let data = {};
        data.recordID = recordID;
        $.post("../workRecord/deleteWorkRecordByKey.dao", data, (results) => {
            if (results == '1') {
                searchWorkRecord();
            } else {
                alert('删除失败！');
            }
        }, 'text');
    }
</script>
</html>