<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" type="text/css" href="../css/workRecord.css" />
    <link rel="stylesheet" type="text/css" href="../css/common.css" />

    <link href="../css/bootstrap.css" type="text/css" rel="stylesheet">
    <script type="text/javascript" src="../js/jquery-3.3.1.js"></script>
    <script type="text/javascript" src="../js/bootstrap.js"></script>
    <script type="text/javascript" src="../js/common.js"></script>
</head>
<body>
<header class="commonHeader">
    <div class="login-div">
        <img src="../images/monkey1.jpg" id="imgPhoto">
        <span class="loginIDStyle" id="loginNickname">一寸灰</span>
    </div>
</header>
<main class="mainClass">
    <aside class="workAside"></aside>
    <div class="workContent">
        <div class="work-form-div">
            <form id="workRecordForm" >
                <div class="">
                    <input type="hidden" name="isSubmit" value=""/>
                    <input type="hidden" name="recordID" value=""/>
                    <label for="recordTitle"></label><input type="text"id="recordTitle" name="title" placeholder="请输入标题" />
                </div>
                <div>
                   <textarea class="write-recordContent" placeholder="正文" name="content"></textarea>
                    <input type="file" value="上传附件"/>
                </div>
                <div class="write-save-div">
                    <input type="button" value="保存" onclick="addWorkRecord()"/>
                </div>

            </form>
        </div>

    </div>
    <div class="file-div">
        <div class="file-title">
            <span>附件</span>
        </div>

    </div>
</main>
<footer>
</footer>

</body>
<script type="text/javascript">

    //设置连接的点击样式
    $(() =>{
        $('nav li:nth-of-type(1)').addClass('active');
        $.post('../staff/getLoginStaffVO.dao','',(results) =>{
            console.log(results.nickname);
            $('#loginNickname').text(results.nickname);

        },'json');
    });

    $('#allChecked').change(function(){
        $('#showWorkRecord input[type="checkbox"][name="workRecordCheck"]').prop('checked',$(this).is(':checked')?true:false);
    });
    function buttonOperation() {
        var operationType = $('#modalWorkRecord input[name="operationType"] ').val();
        // alert(operationType);
        if (operationType=='1'){
            addWorkRecord()
        }else if (operationType=='2'){
            modifyWorkRecord()
        }
    }
    function add() {
        $('#modalWorkRecord input[name="operationType"]').val("1");
        $('#modalWorkRecord textarea[name="completed"]').val('');
        $('#modalWorkRecord textarea[name="noCompleted"]').val('');
        $('#modalWorkRecord textarea[name="comments"]').val('');
        $('#myModal').modal('show');
    }
    function addWorkRecord() {

        var data={};
        data.content=$('#workRecordForm textarea[name="content"]').val();
        data.title=$('#workRecordForm input[name="title"]').val();
        console.log(data);
        var isSubmit=$('#workRecordForm input[name="isSubmit"]').val();
        //isSubmit==1表示不能存在此记录，需要新添加
        if(isSubmit==1){
            // alert(data.comments);
            $.post("../workRecord/insertWorkRecord.dao", data, function (results) {

            }, "text");

        }else{
            $.post("../workRecord/updateWorkRecordByKey.dao", data, function (results) {
                // console.log(results);
                searchWorkRecord();

            }, "text");
        }

    }

    function modify() {
        let $compnent = $('#showWorkRecord input[name="workRecordCheck"]:checked').parent('td').parent('tr');
        if ($compnent.length<1){
            alert('请选择一条数据！')
        } else if ($compnent.length>1){
            alert('只能选择一条数据！')
        } else{
            $('#modalWorkRecord input[name="operationType"]').val("2");
            $('#modalWorkRecord input[name="recordID"]').val($compnent.eq(0).children('td[name="recordID"]').text());
            $('#modalWorkRecord textarea[name="completed"]').val($compnent.eq(0).children('td[name="completed"]').text());
            $('#modalWorkRecord textarea[name="noCompleted"]').val($compnent.eq(0).children('td[name="noCompleted"]').text());
            $('#modalWorkRecord textarea[name="comments"]').val($compnent.eq(0).children('td[name="comments"]').text());
            $('#myModal').modal('show');
            searchWorkRecord();
        }
    }
    function modifyWorkRecord() {
        var data={};
        data.recordID=$('#modalWorkRecord input[name="recordID"]').val();
        data.completed=$('#modalWorkRecord textarea[name="completed"]').val();
        data.noCompleted=$('#modalWorkRecord textarea[name="noCompleted"]').val();
        data.comments=$('#modalWorkRecord textarea[name="comments"]').val();
        // console.log(data);
        // alert(data.recordID);
        $.post("../workRecord/updateWorkRecordByKey.dao", data, function (results) {
            // console.log(results);

            searchWorkRecord();

        }, "text");
    }
    function  deleteWorkRecord() {
        let $compnent =$('#showWorkRecord input[name="workRecordCheck"]:checked').parent('td').parent('tr');
        var recordID='';
        for (var i=0;i<$compnent.length;i++){
            if (i==0){
                recordID=$compnent.eq(i).children('td[name="recordID"]').text();
            }else{
                recordID +=','+$compnent.eq(i).children('td[name="recordID"]').text();
                console.log(recordID);
            }
        }
        alert(recordID);
        let data={};
        data.recordID=recordID;
        $.post("../workRecord/deleteWorkRecordByKey.dao",data,(results) =>{
            if (results=='1'){
                searchWorkRecord();
            } else {
                alert('删除失败！')
            }
        },'text');
    }
</script>
</html>